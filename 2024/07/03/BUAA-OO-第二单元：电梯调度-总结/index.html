<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="rainbowYao">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://yyybbbyyyb.github.io/2024/07/03/buaa-oo-第二单元：电梯调度-总结/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="前言  春风若有怜花意，可否许我再U2  第二单元电梯调度我认为有两条主线需要注意，一个是线程安全，另一个是设计好的调度算法来提升性能。本人大部分精力是放在了线程安全上，故从本文中能得到的性能提升方面的分享并不多（而且大多是我从别人那听来的，自己并未实现，只有思路简述），而我更多的分享是站在普通人的视角，在保证正确性、安全性的前提下来介绍OO最具可玩性的电梯单元 本人自认为第二单元的完成度很低，知">
<meta property="og:type" content="article">
<meta property="og:title" content="BUAA_OO 第二单元：电梯调度 总结">
<meta property="og:url" content="https://yyybbbyyyb.github.io/2024/07/03/BUAA-OO-%E7%AC%AC%E4%BA%8C%E5%8D%95%E5%85%83%EF%BC%9A%E7%94%B5%E6%A2%AF%E8%B0%83%E5%BA%A6-%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="rainbowYao&#39;s Blog">
<meta property="og:description" content="前言  春风若有怜花意，可否许我再U2  第二单元电梯调度我认为有两条主线需要注意，一个是线程安全，另一个是设计好的调度算法来提升性能。本人大部分精力是放在了线程安全上，故从本文中能得到的性能提升方面的分享并不多（而且大多是我从别人那听来的，自己并未实现，只有思路简述），而我更多的分享是站在普通人的视角，在保证正确性、安全性的前提下来介绍OO最具可玩性的电梯单元 本人自认为第二单元的完成度很低，知">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_5_uml.jpg">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_6_uml.jpg">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/%E6%97%B6%E5%BA%8F%E5%9B%BE.jpg">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_7_uml.jpg">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/%E6%AD%BB%E9%94%81.jpg">
<meta property="og:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/wxm%E9%87%8F%E5%AD%90%E7%94%B5%E6%A2%AF.png">
<meta property="article:published_time" content="2024-07-03T13:16:24.000Z">
<meta property="article:modified_time" content="2024-08-01T10:12:01.614Z">
<meta property="article:author" content="rainbowYao">
<meta property="article:tag" content="OO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_5_uml.jpg">
    
    
        <!-- Google tag (gtag.js) -->
        <script src="https://www.googletagmanager.com/gtag/js?id="></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', '');
        </script>
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/rainbow.ico" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/rainbow.ico">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/rainbow.ico">
    <!--- Page Info-->
    
    <title>
        
            BUAA_OO 第二单元：电梯调度 总结 -
        
        rainbowYao&#39;s Blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    

    
        
<script src="/js/libs/anime.min.js"></script>

    

    <script id="hexo-configurations">
    window.config = {"hostname":"yyybbbyyyb.github.io","root":"/","language":"zh-CN"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":true,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":true,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/flower.jpg","dark":"/images/flower.jpg"},"title":"This is rainbowYao's Blog","subtitle":{"text":["已老实, 求放过...","我真服了..."],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#000000"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"center","links":{"github":"https://github.com/yyybbbyyyb/","instagram":"https://www.instagram.com/yyb913665114/","zhihu":null,"twitter":null,"email":"22373393@buaa.edu.cn"},"qrs":{"weixin":"/images/wechat.jpg"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.4","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags/","icon":"fa-regular fa-tags"}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"目前文章较少","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/1/1 00:00:00"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



    <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <h2 class="ml13">
        rainbowYao&#39;s Blog
    </h2>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });

        var animation = anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [40,0],
                translateZ: 0,
                opacity: [0,1],
                filter: ['blur(5px)', 'blur(0px)'], // Starting from blurred to unblurred
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i,
            }).add({
                targets: '.ml13 .letter',
                translateY: [0,-40],
                opacity: [1,0],
                filter: ['blur(0px)', 'blur(5px)'], // Ending from unblurred to blurred
                easing: "easeInExpo",
                duration: 1200,
                delay: (el, i) => 100 + 30 * i,
                complete: function() {
                    hidePreloader(); // Call hidePreloader after the animation completes
                }
            });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            setTimeout(hidePreloader, 5000); // Call hidePreloader after 5000 milliseconds if not already called by animation
        });

        function hidePreloader() {
            var preloader = document.querySelector('.preloader');
            preloader.style.opacity = '0';
            setTimeout(function () {
                preloader.style.display = 'none';
            }, 200);
        }
    </script>
</div>

<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/rainbow.ico">
                </a>
            
            <a class="logo-title" href="/">
                
                rainbowYao&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags/"
                                        >
                                    <i class="fa-regular fa-tags fa-fw"></i>
                                    标签
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags/"
                        >
                            <span>
                                标签
                            </span>
                            
                                <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
                
                    
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">6</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">13</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail2.jpg" alt="BUAA_OO 第二单元：电梯调度 总结" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-semibold backdrop-blur-lg rounded-xl border border-border-color ">BUAA_OO 第二单元：电梯调度 总结</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/touxiang.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">rainbowYao</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv2</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-07-03 21:16:24</span>
        <span class="mobile">2024-07-03 21:16:24</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-08-01 18:12:01</span>
            <span class="mobile">2024-08-01 18:12:01</span>
            <span class="hover-info">更新</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/OO/">OO</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p> 春风若有怜花意，可否许我再U2</p>
</blockquote>
<p>第二单元<strong>电梯调度</strong>我认为有两条主线需要注意，一个是<strong>线程安全</strong>，另一个是设计好的<strong>调度算法</strong>来提升性能。本人大部分精力是放在了线程安全上，故从本文中能得到的性能提升方面的分享并不多（而且大多是我从别人那听来的，自己并未实现，只有思路简述），而我更多的分享是站在普通人的视角，在保证正确性、安全性的前提下来介绍OO最具可玩性的电梯单元</p>
<p>本人自认为第二单元的完成度很低，知道很多有趣的想法但无精力去实现，自认为是一次很失败了的旅途，但总觉得要留下一点自己来过的痕迹。故本文不止含有自己代码的分析，也包含从其他同学那里学习来的好的设计方法。本文分篇章进行：<strong>三次迭代—宏观分析篇、多线程—线程安全篇、调度类—性能提升篇</strong>。同时本人提炼了一些关键词，供使用<code>jal</code>指令跳转（其实自己<code>ctrl+F</code>找一下啦，有些部分只是做了简要陈述）：</p>
<ul>
<li>Look策略      </li>
<li>两种类型RESET   </li>
<li>Buffer缓冲方法    </li>
<li>计数器确定线程结束条件  </li>
<li>换乘楼层互斥   </li>
<li>轮询</li>
<li>死锁</li>
<li>量子电梯</li>
<li>弹射起步</li>
<li>影子电梯</li>
<li>评价调度</li>
<li>自由竞争</li>
<li>摩天轮调度</li>
</ul>
<hr>
<h2 id="三次迭代—宏观分析篇"><a href="#三次迭代—宏观分析篇" class="headerlink" title="三次迭代—宏观分析篇"></a>三次迭代—宏观分析篇</h2><h3 id="第一次迭代"><a href="#第一次迭代" class="headerlink" title="第一次迭代"></a>第一次迭代</h3><h4 id="任务简析"><a href="#任务简析" class="headerlink" title="任务简析"></a>任务简析</h4><p>这次任务相对简单，甚至未引入调度策略，我猜测课程组的意图是为了让我们先建立起多线程基本架构，再此基础上再做迭代。故主要需要实现：</p>
<ul>
<li>全局分发请求线程（InputHandle）</li>
<li>电梯线程（Elevator）</li>
<li>运行策略（Strategy）</li>
</ul>
<h4 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h4><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_5_uml.jpg"
                      alt="aaa" style="zoom: 25%;" 
                >

<ul>
<li>结合任务分析，这次迭代含有两个线程：输入线程、电梯线程。依托 <code>RequsetQueue</code> —— 等待队列这一共享对象，实现<strong>生产—消费者模式</strong>。电梯运行策列依托于 <code>Straregy</code> 这一依赖注入类，根据 <code>Strategy</code> 返回的电梯下一个运行状态指导电梯运行（<strong>状态模式</strong>）</li>
</ul>
<h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><h5 id="电梯运行策略类-LookStrategy"><a href="#电梯运行策略类-LookStrategy" class="headerlink" title="电梯运行策略类 LookStrategy"></a>电梯运行策略类 <code>LookStrategy</code></h5><p>采用状态模型，输入电梯当前参数状态（电梯内的乘客表，电梯候乘表，电梯当前楼层等等），经过分析返回电梯下一时刻运行状态（移动、开门、转向等等），因此电梯类 <code>Elevator</code> 中线程运行 <code>run</code> 方法也就是不断进行状态间的转移。本人将电梯分成以下几个状态：<code>OVER</code>、<code>OPEN</code> 、<code>REVERSE</code>、<code>MOVE</code>、<code>WAITING</code>，对应实现代码如下：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Elevator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">ElevatorState</span> <span class="variable">nextElevatorState</span> <span class="operator">=</span> strategy.getNextState(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (nextElevatorState == OVER) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextElevatorState == MOVE) &#123;</span><br><span class="line">                move();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextElevatorState == REVERSE) &#123;</span><br><span class="line">                direction = !direction;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextElevatorState == WAITING) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (requestQueue) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        requestQueue.wait();               <span class="comment">//wait等待队列中addPassenger方法将其唤醒</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextElevatorState == OPEN) &#123;</span><br><span class="line">                openAndClose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//LookStrategy.java</span></span><br><span class="line"><span class="keyword">public</span> ElevatorState <span class="title function_">getNextState</span><span class="params">(Elevator elevator)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">currentFloor</span> <span class="operator">=</span> elevator.getCurrentFloor();</span><br><span class="line">        <span class="type">int</span> <span class="variable">passengerNum</span> <span class="operator">=</span> elevator.getPassengerNum();</span><br><span class="line">        ...<span class="comment">//还需要获取其他的电梯信息</span></span><br><span class="line">        <span class="keyword">if</span> (canOpenElevatorForOut || canOpenElevatorForIn） &#123;    <span class="comment">//此处省略了方法传递的参数</span></span><br><span class="line">            <span class="keyword">return</span> OPEN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (passengerNum != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> MOVE;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (requestQueue.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (requestQueue.isEnd()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> OVER;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> WAITING;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (hasReqInDirection) &#123;             <span class="comment">//等待队列中有和电梯运行同方向的请求</span></span><br><span class="line">                    <span class="keyword">return</span> ElevatorState.MOVE;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> ElevatorState.REVERSE;    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>上面的<strong>Look策略</strong>是我结合<a class="link"   target="_blank" rel="noopener" href="https://hyggge.github.io/2022/04/29/oo/oo-di-er-dan-yuan-zong-jie/" >学长博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>且稍夹带一点自己的改动所写，其中的捎带原则是只捎带与电梯运行方向同向的乘客。</p>
<p>不过只是这样的话就遇到了一个问题：当电梯在最高层开门后放出全部乘客且又进入乘客，此时根据 <code>LookStrategy</code> 中的逻辑，下一个状态应该是<code>MOVE</code> (因为<code>passengerNum != 0</code> ，但此时是最高层啊)，这是因为<strong>缺少一次转向状态 <code>REVERSE</code> 的状态转移</strong> ，故我在 <code>OPEN</code> 状态中增加这一次状态转移的判断：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Elevator.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">openAndClose</span><span class="params">()</span> &#123;</span><br><span class="line">    open();</span><br><span class="line">    outPassenger();</span><br><span class="line">    <span class="type">ElevatorState</span> <span class="variable">state</span> <span class="operator">=</span> strategy.getNextState(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (state == ElevatorState.REVERSE) &#123;</span><br><span class="line">    		direction = !direction;</span><br><span class="line">    &#125;</span><br><span class="line">    inPassenger();</span><br><span class="line">    close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>这个小设计来自于我心目中六系第一人<strong>zyt</strong>，当然也可以通过修改上面的<code>LookStrateg</code>中<code>getNextState</code> 方法的逻辑来规避这个问题，不过很多时候这种小聪明、小设计很能打动我。</p>
<h5 id="生产—消费者模式的托盘：RequestQueue"><a href="#生产—消费者模式的托盘：RequestQueue" class="headerlink" title="生产—消费者模式的托盘：RequestQueue"></a>生产—消费者模式的托盘：RequestQueue</h5><p>关于<strong>生产—消费者模式</strong>这里只做简单描述，后续会在<strong>多线程—线程安全篇</strong>细讲。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RequestQueue.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestQueue</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Passenger&gt; passengers;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;Integer, ArrayList&lt;Passenger&gt;&gt; requestQueueByFromFloor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;Integer, ArrayList&lt;Passenger&gt;&gt; requestQueueByToFloor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isEnd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addPassenger</span><span class="params">(Passenger passenger, <span class="type">int</span> elevatorId)</span> &#123;</span><br><span class="line">        passengers.add(passenger);</span><br><span class="line">        requestQueueByFromFloor.get(passenger.getFrom()).add(passenger);</span><br><span class="line">        requestQueueByToFloor.get(passenger.getTo()).add(passenger);</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">delPassenger</span><span class="params">(Passenger passenger)</span> &#123;</span><br><span class="line">        passengers.remove(passenger);</span><br><span class="line">        requestQueueByFromFloor.get(passenger.getFrom()).remove(passenger);</span><br><span class="line">        requestQueueByToFloor.get(passenger.getTo()).remove(passenger);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setEnd</span><span class="params">(<span class="type">boolean</span> isEnd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isEnd = isEnd;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">isEnd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isEnd;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>这里只列举了部分属性和方法，其中对于乘客本人不止用 <code>List</code> 顺序存储，还用两个<code>HashMap</code> 来维护，目的是通过乘客的原始楼层<code>From</code> 或目的楼层<code>To</code> 可以快速索引到，是一种典型的<strong>以空间换时间</strong>的方法。</p>
<p>方法上，由于是<strong>共享对象</strong>，全局分发请求线程可以调用add方法放入乘客，电梯线程可以调用del方法接走乘客，故方法需要用互斥锁<code>synchroonized</code> 字段来修饰。其中add方法的<code>notifyAll()</code> 是为了唤醒处于wait状态的电梯。（呼应了前面<code>elevatorReq.wait()</code>）</p>
<p>除此之外，<code>isEnd</code>属性和<code>setEnd</code>方法的作用是结束线程，表示这个请求队列不会再加入新的请求，第二次迭代的线程运行时序图也能体现这里的作用</p>
<h3 id="第二次迭代"><a href="#第二次迭代" class="headerlink" title="第二次迭代"></a>第二次迭代</h3><h4 id="任务简析-1"><a href="#任务简析-1" class="headerlink" title="任务简析"></a>任务简析</h4><p>这次任务是三次迭代中困难跨度最大的，增加了调度的需求，同时电梯增加了RESET的功能，故主要需要实现：</p>
<ul>
<li>调度线程（Dispatch）</li>
<li>电梯RESET功能（Elevator）</li>
</ul>
<h4 id="UML类图-1"><a href="#UML类图-1" class="headerlink" title="UML类图"></a>UML类图</h4><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_6_uml.jpg"
                      alt="abd15e5a2fda9dd69549d1280e1d3e9" style="zoom:25%;" 
                >

<ul>
<li>结合任务，我在电梯线程和全局分发请求线程中间加入了<strong>调度线程</strong>，同时应用接口实现了三种不同的调度算法。RESET的实现在电梯类<code>Elevator</code>中不可见；<code>InfoElevator</code> 是实现评价调度算法时的托盘，后续<strong>调度类—性能提升篇</strong>细讲；<code>Counter</code>是计数器，用来确定线程结束条件，后文具体实现会讲。</li>
</ul>
<h4 id="具体实现-1"><a href="#具体实现-1" class="headerlink" title="具体实现"></a>具体实现</h4><h5 id="RESET的实现，基于强行阻塞"><a href="#RESET的实现，基于强行阻塞" class="headerlink" title="RESET的实现，基于强行阻塞"></a>RESET的实现，基于强行阻塞</h5><p>以下是本人的实现方法，后面还会简单介绍其他人好的实现方法。</p>
<p>先关注<strong>RESET前置操作</strong>，很多人是<strong>将<code>ResetRequest</code>包装成和<code>PersonRequest</code>相同的请求放入到等待队列中</strong>再去让电梯响应，这个做法我认为好处在于可以<strong>同步</strong>乘客请求和重置请求，保证处理顺序的一致性。而我是使用了一种<strong>异步</strong>的方法：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//InputHandle.java</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (request <span class="keyword">instanceof</span> ResetRequest) &#123;</span><br><span class="line">  	<span class="type">ResetRequest</span> <span class="variable">req</span> <span class="operator">=</span> (ResetRequest) request;</span><br><span class="line">  	<span class="type">int</span> <span class="variable">elevatorId</span> <span class="operator">=</span> nor.getElevatorId();</span><br><span class="line">    Elevators.getElevator(elevatorId).initReset(req.getCapacity(), req.getSpeed());</span><br><span class="line">  </span><br><span class="line"><span class="comment">//Elevator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initNormalReset</span><span class="params">(<span class="type">int</span> maxRequestNum, <span class="type">double</span> moveTime)</span> &#123;      <span class="comment">//其实是第三次迭代的写法，区分了normalReset、doubleReset</span></span><br><span class="line">		<span class="keyword">synchronized</span> (requestQueue) &#123;</span><br><span class="line">				<span class="built_in">this</span>.resetMaxRequestNum = maxRequestNum;</span><br><span class="line">         <span class="built_in">this</span>.resetMoveTime = moveTime;</span><br><span class="line">         <span class="built_in">this</span>.resetType = ResetType.NORMAL;</span><br><span class="line">         requestQueue.notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">normalReset</span><span class="params">()</span> &#123;</span><br><span class="line">  	maxRequestNum = resetMaxRequestNum;</span><br><span class="line">		moveTime = resetMoveTime;</span><br><span class="line">  	outAllPassengerReset();</span><br><span class="line">  	outAllRequestAndReset();</span><br><span class="line">  	<span class="built_in">this</span>.resetType = ResetType.NONE;</span><br><span class="line">  	infoSync();            																					<span class="comment">//同步信息给infoElevator</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">outAllRequestAndReset</span><span class="params">()</span> &#123;      </span><br><span class="line">  	<span class="keyword">synchronized</span> (requestQueue) &#123;</span><br><span class="line">      	<span class="comment">//print（RESET_BEGIN)</span></span><br><span class="line">      	<span class="comment">//将requestQueue中的请求放回总表重新调度</span></span><br><span class="line">      	<span class="comment">//sleep（RESET_TIME * 1000);</span></span><br><span class="line">      	<span class="comment">//print（RESET_END)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//LookStrategy.java</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isReset</span> <span class="operator">=</span> elevator.isReset();</span><br><span class="line"><span class="keyword">if</span> (isReset) &#123;</span><br><span class="line">		<span class="keyword">return</span> RESET;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></div>

<p>通过以上代码就可以看出我的<strong>异步</strong>指的是电梯得到了RESET的通知是异步的，通过<code>initReset</code>改变电梯中<code>resetType</code> 这一属性，再通过<code>LookStrategy</code>策略类<strong>同步</strong>重置这一操作。</p>
<p>另外，<code>initReset</code> 取走了<code>requestQueue</code>的锁，这里的目的是为了后续<code>notifyAll</code> 可以唤醒wait状态的电梯。此处会很奇怪，因为<code>initReset</code>并未处理共享区，此处拿锁只为了唤醒，如果为了合理性，我觉得可以再设置其他的锁。<strong>将reset包装成乘客请求</strong>的方法应该依靠的是<code>addPassenger</code>的<code>notifyAll</code>，本质是一样的。</p>
<p>至于强行阻塞，首先想这个问题：如何处理正在<strong>RESET的电梯的调度</strong>？互测中大家经常使用六个电梯同时RESET；或者将一个电梯先RESET的很慢，然后在最后一秒另外五个电梯同时RESET且输入所有的请求，如果处理不好这所有的指令都会分配给那一台提前RESET完很慢的电梯，这样子会超时。</p>
<p>为了应对以上的问题，我处理RESET的原则是：<strong>可以给RESET的电梯分配请求</strong>。但是又需要保证RESET的电梯输出”RESET-BEGIN“后不可以”RECIEVE“请求，这就用到了我上面代码中<code>outAllRequestAndReset</code>方法的设计，这个方法取走了<code>requestQueue</code>的锁，然后再进行<strong>输出RESET-BEGIN</strong>、<strong>清空等待队列</strong>等操作，并且在电梯<code>sleep</code>的过程中也不释放锁，这就导致如果调度线程<code>Dispatch</code>要给该电梯<code>addPassenger</code>会被阻塞（因为<code>addPassenger</code>也需要<code>requestQueue</code>的锁），而我”RECIEVE“的输出在<code>addPassenger</code>方法中，这就保证”RECIEVE“的输出要么在”RESET-BEGIN“前（这样的”RECIEVE“会被打回总表重新调度）；要么在”RESET-END“后（可能请求的分发在“RESET-END”之前，但被阻塞了，只能重置完成再输出“RECIEVE”。</p>
<p>但很多人应该发现，我这个设计会导致调度线程被强制阻塞”RESET_TIME“这么久，是这样的。但是这么设计保证了正确性，同时从全局分析，电梯RESET完分配的兴许会更合理。不过下面会介绍其他同学使用的<strong>buffer缓冲方法</strong>，可以规避调度线程被阻塞这个问题。</p>
<h5 id="Buffer缓冲方法"><a href="#Buffer缓冲方法" class="headerlink" title="Buffer缓冲方法"></a>Buffer缓冲方法</h5><p>也是本人的好室友zyt和我讲的，同时我发现很多人也都使用的这个方法，可见这并不是小聪明，小设计，反而缓冲的思想应用价值很高。</p>
<p>因为本人并未实现，只能借助他人的代码简单分析，但如果”后人“想要使用这种方法可以进一步深入思考并践行</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这段代码摘录于wxm同学的实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (request <span class="keyword">instanceof</span> Person) &#123;</span><br><span class="line">      	<span class="keyword">if</span> (inResetting) &#123;</span><br><span class="line">        		buffer.add((Person)request);</span><br><span class="line">      	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          	personRequests.add((Person) request);</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">takeBuffer</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">//将buffer中的乘客全部移动到personRequests中</span></span><br><span class="line">		buffer.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>在输出“RESET-END”后调用<code>takeBuffer</code>将buffer中的乘客倾倒入<code>personRequest</code>，倾倒的过程中再输出“RECIEVE”，这样子处理可以规避上面阻塞调度线程的问题，同时也允许调度线程给RESET中的电梯分派乘客。</p>
<h5 id="调度线程实现"><a href="#调度线程实现" class="headerlink" title="调度线程实现"></a>调度线程实现</h5><p>相比第一次迭代，这次增加了“总表”<code>globalReq</code> 的设计，<code>InputHandle</code>线程将请求解析后放入到<code>globalReq</code>中，调度线程<code>Dispatch</code> 不断将<code>globalReq</code>中的请求分发给各个电梯线程的<code>requestQueue</code>中，故整个程序的运行时序图如下：</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/%E6%97%B6%E5%BA%8F%E5%9B%BE.jpg"
                      alt="时序图" style="zoom:25%;" 
                >

<p><code>InputHandle</code>接收标准输入流输入，并且不断解析请求放入到<code>globalReq</code>中，<code>globalReq.add</code> 唤醒<code>Dispatch</code>进行调度，将请求分配给各个电梯，<code>elevatorReq.add</code>唤醒电梯运行；当电梯处于<code>RESET</code>状态时，也调用<code>globalReq.add</code>来重新进行请求的分配；同时<code>InputHandle</code>解析完所有的请求且计数器清零的时候发出<code>setEnd</code> 方法，逐层结束线程。</p>
<h5 id="计数器实现线程结束条件"><a href="#计数器实现线程结束条件" class="headerlink" title="计数器实现线程结束条件"></a>计数器实现线程结束条件</h5><p>因为<code>globalReq</code> 会有回流，故线程结束的条件就不能简单的是<code>InputHandle</code>简单处理完所有的输入请求，而是所有的请求都已经输入到总表且电梯不会再有RESET指令，这时才能结束调度线程。而我设计的更加保险，我通过<code>Counter</code>维护所有的乘客数量，当<code>Counter</code>清零时即所有乘客都送达目的地，再结束所有线程（感觉会造成一点点程序运行的耗时，但微乎其微啦）</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Counter.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">totalRequestCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">(<span class="type">int</span> count)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">(<span class="type">int</span> count)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>当然也可以简单处理，只维护一个<code>passengerNum</code>变量（yt貌似是这么做的），但是一定要做这个考量，不然调度线程提前结束，<code>globalReq</code>的回流无法处理</p>
<h3 id="第三次迭代"><a href="#第三次迭代" class="headerlink" title="第三次迭代"></a>第三次迭代</h3><h4 id="任务简析-2"><a href="#任务简析-2" class="headerlink" title="任务简析"></a>任务简析</h4><p>这次任务相比第二次迭代的改动并不多，因为架构已经确定，更多的是在此基础上拓展<strong>双轿厢电梯</strong>，使其适配已有的调度算法并可正确运行，故主要需要实现：</p>
<ul>
<li>双轿厢电梯安全运行（TransferFloor）</li>
<li>双轿厢doubleReset（Elevator）</li>
</ul>
<h4 id="UML类图-2"><a href="#UML类图-2" class="headerlink" title="UML类图"></a>UML类图</h4><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/hw_7_uml.jpg"
                      alt="abd15e5a2fda9dd69549d1280e1d3e9" style="zoom:25%;" 
                >

<p>放大粉色部分为新增，只增加了<code>TransferFloor</code>换乘楼层类，并且可以在<code>Elevator</code>类中创建新的电梯（也就是他的双轿厢），二者共用一个<code>TransferFloor</code>来达到互斥，不同时进入换成楼层的需求</p>
<h4 id="具体实现-2"><a href="#具体实现-2" class="headerlink" title="具体实现"></a>具体实现</h4><h5 id="TransferFloor换乘楼层互斥"><a href="#TransferFloor换乘楼层互斥" class="headerlink" title="TransferFloor换乘楼层互斥"></a>TransferFloor换乘楼层互斥</h5><p>这个方法也是学习的讨论区中某同学分享的思路：即让两个轿厢共享一个对象，来互斥进入，同时做一些硬性规定，如电梯进入换成楼将人全部放出后立刻离开换乘楼层。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TransferFloor.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransferFloor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger floorNum;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setOccupied</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">this</span>.state == State.OCCUPIED) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.state = State.OCCUPIED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = State.EMPTY;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Elevator.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">()</span> &#123;</span><br><span class="line">		direction = doubleType != <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">		open();          <span class="comment">//不事不登换层楼，肯定是要接人或者放人，直接开门</span></span><br><span class="line">		<span class="keyword">if</span> (!passengers.isEmpty()) &#123;</span><br><span class="line">				outAllPassenger();</span><br><span class="line">		&#125;</span><br><span class="line">		inPassenger();</span><br><span class="line">		close();</span><br><span class="line">		move();	        </span><br><span class="line">		<span class="built_in">this</span>.transferFloor.setEmpty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">()</span> &#123;</span><br><span class="line">		...</span><br><span class="line">		<span class="keyword">if</span> (currentFloor == transferFloor.getFloorNum() &amp;&amp; resetType == ResetType.NONE) &#123;</span><br><span class="line">				transferFloor.setOccupied();</span><br><span class="line">		&#125;</span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>transfer</code> 方法是<code>LookStrategy</code>返回电梯状态为<code>TRANSFER</code>时调用，保证电梯在换乘楼工作完后立刻离开</p>
<h5 id="doubleReset的实现"><a href="#doubleReset的实现" class="headerlink" title="doubleReset的实现"></a>doubleReset的实现</h5><p>我觉得这个是这次迭代最难的点，依旧沿用我之前先<code>initReset</code>导致了很多问题，比如信息更改的时期，以及做严重的是和调度线程的交互，因为之前调度类可以给<code>RESET-BRGIN</code>的电梯派遣请求，但是<code>RECIEVE</code>的输出要延后。可现在如果给某个轿厢派遣请求，但他不一定能完成这个请求，比如这个请求乘客的出发楼层不在该电梯的运行范围内，所以要做好<strong>电梯属性的设置</strong>以及<strong>调度算法的设计</strong></p>
<p>本人这里只简单说明下自己的设计，但是自己设计的真的很烂，有很大的优化空间，‘’后人‘’可以参考这个方向然后实现更好的设计</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Elevator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initDouble</span><span class="params">(<span class="type">int</span> transferFloor, <span class="type">int</span> maxRequestNum, <span class="type">double</span> moveTime)</span> &#123;</span><br><span class="line">  	<span class="keyword">synchronized</span> (elevatorReq) &#123;</span><br><span class="line">      	<span class="built_in">this</span>.resetType = ResetType.DOUBLE;</span><br><span class="line">      	<span class="built_in">this</span>.transferFloor.setFloorNum(transferFloor);</span><br><span class="line">      	<span class="built_in">this</span>.resetMaxRequestNum = maxRequestNum;</span><br><span class="line">      	<span class="built_in">this</span>.resetMoveTime = moveTime;</span><br><span class="line">      elevatorReq.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doubleReset</span><span class="params">()</span> &#123;</span><br><span class="line">  	<span class="comment">//A init reset</span></span><br><span class="line">  	maxRequestNum = resetMaxRequestNum;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">this</span>.infoSync();</span><br><span class="line">		</span><br><span class="line">  	<span class="comment">//reset and outReq</span></span><br><span class="line">  	outElevatorReqAndReset(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//A finish reset</span></span><br><span class="line">  	<span class="built_in">this</span>.printId = elevatorId + <span class="string">&quot;-A&quot;</span>;</span><br><span class="line">  	<span class="built_in">this</span>.resetType = ResetType.NONE;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//B finish reset</span></span><br><span class="line">    <span class="type">Elevator</span> <span class="variable">elevator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Elevator</span>(elevatorId + <span class="number">6</span>);</span><br><span class="line">    elevator.setPrintId(elevatorId + <span class="string">&quot;-B&quot;</span>);</span><br><span class="line">    elevator.setCurrentFloor(transferFloor.getFloorNum() + <span class="number">1</span>);</span><br><span class="line">    ...</span><br><span class="line">		elevator.infoSync();</span><br><span class="line">		</span><br><span class="line">  	<span class="comment">//add B</span></span><br><span class="line">  	Elevators.addElevator(elevator);</span><br><span class="line">  	elevator.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>所以我的电梯在进行doubleReset的过程中是可以接收它可以处理的请求的，但如果当前的<code>Elevators</code>中的电梯都不能处理某个请求（比如六个电梯都在doubleReset，这时候还没有B电梯加入进来，11楼出发的人1-6号A电梯都无法满足），调度类需要等待新的电梯加入。</p>
<hr>
<h2 id="多线程—线程安全篇"><a href="#多线程—线程安全篇" class="headerlink" title="多线程—线程安全篇"></a>多线程—线程安全篇</h2><h3 id="多线程函数的使用"><a href="#多线程函数的使用" class="headerlink" title="多线程函数的使用"></a>多线程函数的使用</h3><p>这里在第一次迭代中特别困惑我，因为对于一个第一次接触多线程的人来说，许多陌生的函数，线程的各种状态之间的转换，多线程的不可控都让我不敢写代码。故这里只简单罗列下当时自己学习线程函数时候的心得：</p>
<blockquote>
<p><strong>wait()</strong></p>
<ul>
<li>如果调用某个对象的 <code>wait()</code> 方法，它会使当前线程等待并释放该对象的锁。</li>
<li>在这种情况下，需要确保在调用 <code>wait()</code> 方法之前已经获取了对象的锁，否则会抛出 <code>IllegalMonitorStateException</code> 异常。</li>
<li>在这种情况下，只有持有该对象锁的其他线程才能调用该对象上的 <code>notify()</code> 或 <code>notifyAll()</code> 方法来唤醒等待中的线程。</li>
<li>上面持有锁的方式有方法用<code>synchronized</code>字段修饰或者代码段用<code>synchronized</code>修饰</li>
</ul>
<p><strong>synchronized</strong>字段</p>
<ul>
<li>用该字段修饰了<strong>方法或者代码段</strong>说明调用这个方法的线程获得了<strong>对象的锁</strong>，其他线程中的需要<strong>获得该对象的锁的方法</strong>在该方法或代码段执行完之前，会被阻塞住（我认为相当于wait），等待<code>notify</code>将其唤醒</li>
</ul>
<p><strong>notify()</strong></p>
<ul>
<li>即唤醒线程等待队列中的线程，我听说所有的<code>notify</code>都可以用<code>notifyAll</code>来代替（不敢苟同，但我确实使用的都是notifyAll），但二者确实都之能唤醒一个线程等待队列中的线程</li>
</ul>
</blockquote>
<p>上面一部分只是在oo课程中的介绍很少，更多的在于自己查阅资料，阅读源码去学习，并且更多的是在实践中掌握（写了一遍代码之后我多少有点理解，但也不敢讲说很熟练），另外os理论课中也有对线程同步互斥的介绍（信号量、管程等），可惜U2结束了它才讲，有点倒反天罡。</p>
<h3 id="线程安全的实现"><a href="#线程安全的实现" class="headerlink" title="线程安全的实现"></a>线程安全的实现</h3><p>从全局来看本人代码中涉及线程安全的部分：</p>
<ul>
<li><p>被<code>synchronized</code>修饰的方法&#x2F;代码段：</p>
<ul>
<li><code>RequestQueue</code>中add、del、setEnd等方法</li>
<li><code>TransferFloor</code>中的<code>setOccupied</code>、<code>setEmpty</code> 方法</li>
<li><code>InfoElevator</code>中的<code>getCost</code>、set方法</li>
</ul>
<p>  以上三个会发现都是共享对象，1、3还是生产—消费者模式中的托盘</p>
<ul>
<li><p><code>Elevator</code> 在从等待队列中取走乘客或将等待队列回流时需要锁住<code>requestQueue</code></p>
</li>
<li><p><code>Dispatch</code>在向电梯等待队列中加入乘客时需要锁住<code>requestQueue</code></p>
</li>
</ul>
</li>
<li><p><code>wait</code>方法：</p>
<ul>
<li><code>InputHandle</code>等待<code>Counter</code>被清零</li>
<li><code>Dispatch</code>等待<code>globalReq</code>的<code>notify</code></li>
<li><code>Elevator</code>等待<code>requestQueue</code>的<code>notify</code></li>
<li><code>TransferFloor</code>中<code>setOccupied</code>方法中等待<code>setEmpty</code>的<code>notify</code></li>
</ul>
</li>
<li><p><code>notify</code>方法：</p>
<ul>
<li><code>RequestQueue</code> 中add、setEnd方法执行后<code>notifyAll</code></li>
<li><code>TransferFloor</code>中<code>setEmpty</code>执行后<code>notifyAll</code></li>
<li><code>Counter</code>中<code>decrement</code> 执行后<code>notifyAll</code></li>
<li><code>Elevator</code>中<code>initReset</code>结束后执行<code>notifyAll</code></li>
</ul>
</li>
</ul>
<p>此外我的<code>Counter</code>类使用<code>AtomicInteger</code>维护，<code>Elevators</code>静态类用<code>ConcurrentHashMap&lt;Integer, Elevator&gt;</code>来维护，读写锁我没有使用，但是读写锁更灵活，也值得考量</p>
<p>其实这些线程安全方法的设置很灵活多变，我上面的赘述只是方向上的提供思路，具体实现细节也复杂多变。但需要保证自己的程序不出现轮询和死锁，下面会对这两个典型bug做介绍</p>
<h3 id="轮询"><a href="#轮询" class="headerlink" title="轮询"></a>轮询</h3><p>轮询其实谈不上是bug，但是会导致cpu占用时间过高，造成CTLE。这个一般是由于多次重复的<code>while</code>等待条件的到来所导致的，线程方法中的<code>wait</code>、<code>sleep</code>、<code>synchromozed</code>修饰方法取锁失败等都会让线程挂起而不占用cpu，故在走查的debug方式下，应该更加关注<code>while</code>语法的出现部分，同时有人提出可以使用IDEA自带的性能分析工具来分析热点函数，本人并未使用过，不做评价。</p>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>死锁一般是由于两个线程都需要前后两次取锁，但二者取锁顺序不同，导致都卡在了第二次取锁的地方，这时候二者都被挂起，线程未结束，最后会RTLE。（当然也可能是三者或以上循环取锁导致取不到）</p>
<p>针对死锁的走查，本人是观察所有的<code>synchromozed</code>修饰的方法和代码段，观察全局取锁顺序是否保持一致，或者如果发生了不一致，可否安全的结束<code>synchromozed</code>修饰的方法和代码段，附上一张本人走查时候画的图：</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/%E6%AD%BB%E9%94%81.jpg"
                      alt="abd15e5a2fda9dd69549d1280e1d3e9" style="zoom:25%;" 
                >

<p>有人讲说比如全局取锁顺序都是先A后B，但是有一个地方只能先B后A，那么可以在BA的外面再套一层A，即ABA的取锁方式，虽然听着很离谱，但我觉得有一定的可行性（未尝试过，不敢妄下定论）</p>
<p>当然de死锁的bug的时候<strong>复现死锁</strong>是非常重要的，使用调试模式，一旦程序不输出了，按暂停观看各个线程的运行情况，当然死锁的复现不是百发百中的，这种交给运气的事确实有点逆天。</p>
<h3 id="生产—消费者模式"><a href="#生产—消费者模式" class="headerlink" title="生产—消费者模式"></a>生产—消费者模式</h3><p>其实前面已经讲到了<code>RequestQueue</code>是<code>Dispatch</code>和<code>Elevator</code>生产消费的托盘；<code>globalReq</code>是<code>InputHandle</code>和<code>Dispatch</code>的托盘；最后新增的<code>InfoElevator</code>是<code>Elevator</code>和<code>Dispatcher</code>的托盘。</p>
<p>其实这么设计出来有点奇怪，原本的需求是调度类需要得到电梯的信息，需要去电梯中获取（调用电梯的<code>get</code>方法），但是我害怕会引发线程不安全，故设计了<code>InfoElevator</code>，电梯将信息写入这里（调用<code>InfoElevator</code>的<code>set</code>方法），然后调度算法对<code>InfoElevator</code>做操作，这样又建立起来了一个生产—消费的桥梁。</p>
<p>不过实践下来觉得除了体系结构上更好看（也没好看到哪去），没有什么实质性的提升，不如调度算法需要对电梯做评分的时候现取现用（本人使用的调度算法是评价算法）</p>
<hr>
<h2 id="调度类—性能提升篇"><a href="#调度类—性能提升篇" class="headerlink" title="调度类—性能提升篇"></a>调度类—性能提升篇</h2><p>这里便是在保证安全性的前提下 ，拉高了U2可玩性上限的地方。本人实现的调度算法是<strong>评价算法</strong>（一种低投入中回报的算法），相比于<strong>影子电梯</strong>的高投入高回报，各有千秋吧。同时我也会介绍一些好玩的小设计（不少是听来的）</p>
<h3 id="量子电梯"><a href="#量子电梯" class="headerlink" title="量子电梯"></a>量子电梯</h3><p>我对量子电梯的理解是不死板的使用<code>sleep</code> 、<code>wait</code> 去让电梯等待刚刚好的时间，而是在这些时间内做很多特判，来思考是否有更好的运行方式。（应该是电梯运行策略的范畴）</p>
<p>比如下面这个例子（摘自<a class="link"   target="_blank" rel="noopener" href="http://oo.buaa.edu.cn/assignment/512/discussion/1545" >wxm分享 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>）：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/post/wxm%E9%87%8F%E5%AD%90%E7%94%B5%E6%A2%AF.png"
                      alt="image-20240420171314673"
                ></p>
<p>说白了就是对<code>sleep|wait</code>的时间做压缩，使其“不知所处”或者“耗时计算”的时间纳入到运行的时间里</p>
<blockquote>
<p>本人只是简单介绍，更加详细优秀的介绍如下：</p>
<p><a class="link"   target="_blank" rel="noopener" href="http://oo.buaa.edu.cn/assignment/512/discussion/1545" >wxm：影子电梯+量子电梯实现过程实录 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="http://oo.buaa.edu.cn/assignment/510/discussion/1534" >bzh：等一会再关门——一种优化的量子电梯策略 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<h3 id="弹射起步"><a href="#弹射起步" class="headerlink" title="弹射起步"></a>弹射起步</h3><p>这个说法来自于肖老师的博客（肖老师好像还是听另一个zyt说的）</p>
<ul>
<li>因为电梯运行时间是根据两个arrive之间的时间来考虑的。</li>
<li>所以每个电梯的第一个arrive，它没有参照物，它不需要sleep</li>
</ul>
<h3 id="影子电梯"><a href="#影子电梯" class="headerlink" title="影子电梯"></a>影子电梯</h3><p>该算法是我觉得目前来讲U2的最高水准，由于本人尝试且以失败告终了，想学技术的人请直接跳转到友链吧</p>
<blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="http://oo.buaa.edu.cn/assignment/512/discussion/1545" >wxm：影子电梯+量子电梯实现过程实录 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>这篇经验分享真的被我吹爆，从知识的灌输，体会的分享各个方面都让人眼前一新</p>
<p>（没有OO平台账号是不是看不了啊，不知道咋办不知道咋办）</p>
</blockquote>
<p>那我下面就赘述下我是被什么困难所挡住了：</p>
<p>首先我一开始理解的影子电梯就出问题了，我以为影子电梯只模拟所有电梯接到这个请求的最短时间，但后来得知事实上还要模拟运送这个乘客，计算将其送到站所需的最短时间。所以看起来最好的做法就是完全模拟电梯运行的逻辑，将电梯运行中<code>sleep|wait</code>都换乘<code>costTime+=</code>。</p>
<p>所以影子电梯两大难点可以分为：<strong>克隆环节</strong>，<strong>模拟环节</strong></p>
<p>克隆环节要注意时间戳的处理，要考量线程安全……很多维度都需要去注意，同时还要思考自己要做的是一个十分细颗粒度的模拟还是一个允许一定误差的模拟，有时颗粒度越细也不一定会得到很好的效果。</p>
<p>好了，no do no bb，上面的话只是庸人自扰，倔强的瞻仰下这个高投入高回报的方法，下面的哦评价调度是自己真正使用的算法</p>
<h3 id="评价调度"><a href="#评价调度" class="headerlink" title="评价调度"></a>评价调度</h3><p>评价调度就是提取电梯当时的一些状态特征，如：在哪层楼、运行速度、最大乘客量、等待队列中的人等等，用这些指标来做一个评价，电梯会得到一个评分，让评分最优的电梯去接这个乘客。</p>
<p>故我们可以得到很多结论：</p>
<ul>
<li>乘客起始楼层和电梯当前楼层距离越短越优（注意方向啊，上行的2楼电梯和1楼的乘客距离可不只是1层）</li>
<li>候乘表中的人和电梯里的人人数越少越优</li>
<li>运行速度越快越优</li>
<li>最大载客量越大越优</li>
</ul>
<p>故可以粗略的建模成一个公式：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//InfoElevator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getCost</span><span class="params">(Passenger passenger)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!canTransfer(passenger.getFrom(), passenger.getTo())) &#123;</span><br><span class="line">            <span class="keyword">return</span> Constants.INT_MIN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (passengers.size() &gt;= maxRequestNum &amp;&amp; passenger.getFrom() == currentFloor) &#123;</span><br><span class="line">            <span class="keyword">return</span> Constants.INT_MIN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (elevatorReq.size() &gt;= maxRequestNum * <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Constants.INT_MIN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> <span class="variable">estimate</span> <span class="operator">=</span>  ((<span class="number">33</span> - getDistance(passenger) - passengers.size() * <span class="number">10</span> - elevatorReq.size() * <span class="number">10</span> + maxRequestNum * <span class="number">1.3</span> - moveTime * <span class="number">17</span>) / (getDistance(passenger) * moveTime));</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) estimate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>第12行的公式即根据各个指标的性质决定正负号、分子分母、系数大小，这个方法的可玩性在于有优化空间， 可以于影子电梯对拍来调节参数，或者是自回归去优化性能。</p>
<p>同时前面几行我也设计了返回int最小值的做法，当所有的电梯都是最小值的时候，那就等一会再去做评价（其中第一个指标<code>canTransfer</code>是对双轿厢做考量，保证请求电梯一定能接送到</p>
<h3 id="自由竞争"><a href="#自由竞争" class="headerlink" title="自由竞争"></a>自由竞争</h3><p>时代留下的产物，由于这学期课程组有意ban掉这种做法，导致这种低投入高回报的调度算法被淹没在了历史的长河中（肖老师认为可以用增加<strong>电梯磨损</strong>程度这一性能指标来限制自由竞争，但它都被ban了，就放过他吧）</p>
<p>粗略一点的思路就是当得到一个请求之后，让所有的电梯都去运行，争夺这一个请求，谁先抢到就归谁，自由竞争顾名思义。所以就造成了所有的电梯会乱跑的情况（今年的”RECIEVE“限制了这种做法），但是听说效率可以比肩影子电梯</p>
<h3 id="摩天轮调度"><a href="#摩天轮调度" class="headerlink" title="摩天轮调度"></a>摩天轮调度</h3><p>本人在U2之前的胡思乱想，当然和自由竞争有着类似，都是电梯乱跑（但这个不乱），被”RECIEVE“限制ban掉了</p>
<p>粗略思路就是让电梯遍布在所有楼层中（1-11层往返就是22层），那么隔三四层设置一个电梯，让电梯像一个摩天轮一样循环运行，乘客请求到来之后搭乘离他最近的摩天轮轿厢，如果当前电梯已满人，那么就等待下一个摩天轮轿厢。</p>
<p>这样做真的十分费电，而且很无厘头，但是细想他能保证一个很平均的效率，抛去特殊样例的情况下效率应该还可以。</p>
<hr>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>其实其中有很多人尽皆知的点，甚至我的很多设计在大佬们看来很幼稚，但我写了这么多，是想对我这个不那么完美的U2画上一个句号。有人说U2结束，好玩的OO也就结束了。那么既然来过，总要留下一些痕迹。人生若只如初见，人生亦只如初见。</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> BUAA_OO 第二单元：电梯调度 总结</li>
        <li><strong>作者:</strong> rainbowYao</li>
        <li><strong>创建于
                :</strong> 2024-07-03 21:16:24</li>
        
            <li>
                <strong>更新于
                    :</strong> 2024-08-01 18:12:01
            </li>
        
        <li>
            <strong>链接:</strong> https://redefine.ohevan.com/2024/07/03/BUAA-OO-第二单元：电梯调度-总结/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            

            
                本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/OO/">#OO</a>&nbsp;
                    </li>
                
            </ul>
        

        
  <div class="recommended-article px-2 sm:px-6 md:px-8">
   <div class="recommended-desktop">
    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2024/07/03/BUAA-OO-第三单元：社交网络（JML）-总结/" title="BUAA_OO 第三单元：社交网络（JML） 总结" rel="bookmark">
  <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail3.jpg" alt="BUAA_OO 第三单元：社交网络（JML） 总结" class="!max-w-none">
  <span class="title">BUAA_OO 第三单元：社交网络（JML） 总结</span>
</a><a class="recommended-article-item" href="/2024/07/03/BUAA-OO-第一单元：表达式展开-总结/" title="BUAA_OO 第一单元：表达式展开 总结" rel="bookmark">
  <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail1.jpg" alt="BUAA_OO 第一单元：表达式展开 总结" class="!max-w-none">
  <span class="title">BUAA_OO 第一单元：表达式展开 总结</span>
</a><a class="recommended-article-item" href="/2024/07/02/OS-Challenge/" title="OS Challenge" rel="bookmark">
  <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail12.jpg" alt="OS Challenge" class="!max-w-none">
  <span class="title">OS Challenge</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2024/07/03/BUAA-OO-第三单元：社交网络（JML）-总结/" title="BUAA_OO 第三单元：社交网络（JML） 总结" rel="bookmark">
  <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail3.jpg" alt="BUAA_OO 第三单元：社交网络（JML） 总结" class="!max-w-none">
  <span class="title">BUAA_OO 第三单元：社交网络（JML） 总结</span>
</a><a class="recommended-article-item" href="/2024/07/03/BUAA-OO-第一单元：表达式展开-总结/" title="BUAA_OO 第一单元：表达式展开 总结" rel="bookmark">
  <img src="https://blog-yyb.oss-cn-beijing.aliyuncs.com/thumbnail/thumbnail1.jpg" alt="BUAA_OO 第一单元：表达式展开 总结" class="!max-w-none">
  <span class="title">BUAA_OO 第一单元：表达式展开 总结</span>
</a></div>
   </div>
  </div>

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/07/03/BUAA-OO-%E7%AC%AC%E4%B8%89%E5%8D%95%E5%85%83%EF%BC%9A%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%EF%BC%88JML%EF%BC%89-%E6%80%BB%E7%BB%93/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">BUAA_OO 第三单元：社交网络（JML） 总结</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/07/03/BUAA-OO-%E7%AC%AC%E4%B8%80%E5%8D%95%E5%85%83%EF%BC%9A%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B1%95%E5%BC%80-%E6%80%BB%E7%BB%93/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">BUAA_OO 第一单元：表达式展开 总结</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">BUAA_OO 第二单元：电梯调度 总结</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E8%BF%AD%E4%BB%A3%E2%80%94%E5%AE%8F%E8%A7%82%E5%88%86%E6%9E%90%E7%AF%87"><span class="nav-text">三次迭代—宏观分析篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%AD%E4%BB%A3"><span class="nav-text">第一次迭代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%BF%AD%E4%BB%A3"><span class="nav-text">第二次迭代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E8%BF%AD%E4%BB%A3"><span class="nav-text">第三次迭代</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E2%80%94%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%AF%87"><span class="nav-text">多线程—线程安全篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">多线程函数的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">线程安全的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AE%E8%AF%A2"><span class="nav-text">轮询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%BB%E9%94%81"><span class="nav-text">死锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E2%80%94%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-text">生产—消费者模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E7%B1%BB%E2%80%94%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%E7%AF%87"><span class="nav-text">调度类—性能提升篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8F%E5%AD%90%E7%94%B5%E6%A2%AF"><span class="nav-text">量子电梯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E5%B0%84%E8%B5%B7%E6%AD%A5"><span class="nav-text">弹射起步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%B1%E5%AD%90%E7%94%B5%E6%A2%AF"><span class="nav-text">影子电梯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%84%E4%BB%B7%E8%B0%83%E5%BA%A6"><span class="nav-text">评价调度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E7%94%B1%E7%AB%9E%E4%BA%89"><span class="nav-text">自由竞争</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%91%A9%E5%A4%A9%E8%BD%AE%E8%B0%83%E5%BA%A6"><span class="nav-text">摩天轮调度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-text">结语</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">rainbowYao</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共 13 篇文章
                    </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">访问人数</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">总访问量</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.4</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
